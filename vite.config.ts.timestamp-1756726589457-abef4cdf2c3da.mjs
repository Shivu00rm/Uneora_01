// vite.config.ts
import { defineConfig } from "file:///app/code/node_modules/vite/dist/node/index.js";
import react from "file:///app/code/node_modules/@vitejs/plugin-react/dist/index.js";
import path from "path";

// server/index.ts
import "file:///app/code/node_modules/dotenv/config.js";
import express from "file:///app/code/node_modules/express/index.js";
import cors from "file:///app/code/node_modules/cors/lib/index.js";

// server/routes/demo.ts
var handleDemo = (req, res) => {
  const response = {
    message: "Hello from Express server"
  };
  res.status(200).json(response);
};

// server/lib/response.ts
import { randomUUID } from "crypto";
function attachRequestId(req, _res, next) {
  req.requestId = req.headers["x-request-id"] || randomUUID();
  next();
}
function success(req, res, data, status = 200) {
  const body = { success: true, data, requestId: req.requestId };
  res.status(status).json(body);
}
function error(req, res, code, message, details, status = 400, retryable = false) {
  const body = { success: false, code, message, details, requestId: req.requestId, retryable };
  res.status(status).json(body);
}
function errorHandler(err, req, res, _next) {
  const msg = err?.message || "Internal Server Error";
  const details = err?.details || void 0;
  error(req, res, "INTERNAL_ERROR", msg, details, 500, false);
}

// server/lib/eventBus.ts
import { createClient } from "file:///app/code/node_modules/@supabase/supabase-js/dist/main/index.js";
var outbox = [];
var SUPABASE_URL = process.env.SUPABASE_URL;
var SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;
var supabase = null;
if (SUPABASE_URL && SUPABASE_SERVICE_ROLE_KEY) {
  supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY);
}
async function emitEvent(topic, payload) {
  const event = { topic, payload, createdAt: (/* @__PURE__ */ new Date()).toISOString() };
  outbox.push(event);
  if (supabase) {
    try {
      await supabase.from("events_outbox").insert({ topic, payload, status: "pending" });
    } catch (e) {
      console.error("Outbox persist failed", e);
    }
  }
}

// server/routes/stripe.ts
var createCheckoutSession = async (req, res) => {
  const plan = req.body?.plan;
  if (!plan) return error(req, res, "INVALID_REQUEST", "Missing plan", void 0, 400);
  return error(
    req,
    res,
    "STRIPE_NOT_CONFIGURED",
    "Stripe not configured. Set STRIPE_SECRET_KEY and price IDs to enable checkout.",
    void 0,
    501,
    false
  );
};
var createBillingPortal = async (req, res) => {
  return error(
    req,
    res,
    "STRIPE_NOT_CONFIGURED",
    "Stripe not configured. Set STRIPE_SECRET_KEY to enable portal.",
    void 0,
    501,
    false
  );
};
var stripeWebhook = async (req, res) => {
  await emitEvent("billing.webhook_received_unverified", { receivedAt: (/* @__PURE__ */ new Date()).toISOString() });
  return success(req, res, { received: true });
};

// server/routes/admin.ts
var CONFIG_LOG = [
  { id: "cfg-1", change: "Updated plan pricing", at: (/* @__PURE__ */ new Date()).toISOString() },
  { id: "cfg-2", change: "Rotated Slack webhook key", at: (/* @__PURE__ */ new Date()).toISOString() }
];
var exportAuditCSV = async (req, res) => {
  const csv = [
    "id,org,user,action,created_at",
    `e1,TechCorp,admin@techcorp.com,billing.subscription_updated,${(/* @__PURE__ */ new Date()).toISOString()}`
  ].join("\n");
  res.setHeader("Content-Type", "text/csv");
  res.setHeader("Content-Disposition", `attachment; filename="audit-${Date.now()}.csv"`);
  return res.status(200).send(csv);
};
var impersonate = async (req, res) => {
  const userId = req.body?.userId;
  if (!userId) return error(req, res, "INVALID_REQUEST", "Missing userId", void 0, 400);
  await emitEvent("admin.impersonation_requested", { userId, requestedAt: (/* @__PURE__ */ new Date()).toISOString() });
  return success(req, res, { ok: true, note: "Impersonation requires secure backend session exchange; stubbed here." });
};
var replayError = async (req, res) => {
  const id = req.body?.id;
  if (!id) return error(req, res, "INVALID_REQUEST", "Missing id", void 0, 400, false);
  await emitEvent("admin.error_replay_triggered", { id });
  return success(req, res, { ok: true });
};

// server/index.ts
function createServer() {
  const app = express();
  app.use(cors());
  app.use(attachRequestId);
  app.post(
    "/api/stripe/webhook",
    express.raw({ type: "application/json" }),
    (req, _res, next) => {
      req.rawBody = req.body;
      next();
    },
    stripeWebhook
  );
  app.use(express.json());
  app.use(express.urlencoded({ extended: true }));
  app.get("/api/ping", (req, res) => {
    const ping = process.env.PING_MESSAGE ?? "ping";
    return success(req, res, { message: ping });
  });
  app.get("/api/demo", handleDemo);
  app.post("/api/billing/checkout-session", createCheckoutSession);
  app.get("/api/billing/portal", createBillingPortal);
  app.get("/api/admin/audit/export", exportAuditCSV);
  app.post("/api/admin/impersonate", impersonate);
  app.post("/api/admin/errors/replay", replayError);
  app.get("/api/admin/events/outbox", getOutbox);
  app.get("/api/admin/dlq", getDLQ);
  app.post("/api/admin/dlq/replay", dlqReplay);
  app.get("/api/admin/feature-flags", getFeatureFlags);
  app.post("/api/admin/feature-flags", setFeatureFlags);
  app.get("/api/admin/config-changes", getConfigChanges);
  app.get("/api/admin/stripe/events", listStripeEvents);
  app.post("/api/admin/subscriptions/reconcile", reconcileSubscriptions);
  app.post("/api/admin/invites/send", sendInvite);
  app.post("/api/admin/rbac/update", rbacUpdate);
  app.post("/api/admin/gdpr/export", gdprExport);
  app.post("/api/admin/gdpr/delete", gdprDelete);
  app.post("/api/admin/integrations/rotate", rotateKeys);
  app.post("/api/admin/integrations/revoke", revokeKeys);
  app.post("/api/admin/integrations/retry-syncs", retrySyncs);
  app.use(errorHandler);
  return app;
}

// vite.config.ts
var __vite_injected_original_dirname = "/app/code";
var vite_config_default = defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
    fs: {
      allow: ["./client", "./shared"],
      deny: [".env", ".env.*", "*.{crt,pem}", "**/.git/**", "server/**"]
    }
  },
  build: {
    outDir: "dist/spa"
  },
  plugins: [react(), expressPlugin()],
  resolve: {
    alias: {
      "@": path.resolve(__vite_injected_original_dirname, "./client"),
      "@shared": path.resolve(__vite_injected_original_dirname, "./shared")
    }
  }
}));
function expressPlugin() {
  return {
    name: "express-plugin",
    apply: "serve",
    // Only apply during development (serve mode)
    configureServer(server) {
      const app = createServer();
      server.middlewares.use(app);
    }
  };
}
export {
  vite_config_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsidml0ZS5jb25maWcudHMiLCAic2VydmVyL2luZGV4LnRzIiwgInNlcnZlci9yb3V0ZXMvZGVtby50cyIsICJzZXJ2ZXIvbGliL3Jlc3BvbnNlLnRzIiwgInNlcnZlci9saWIvZXZlbnRCdXMudHMiLCAic2VydmVyL3JvdXRlcy9zdHJpcGUudHMiLCAic2VydmVyL3JvdXRlcy9hZG1pbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiY29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2Rpcm5hbWUgPSBcIi9hcHAvY29kZVwiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiL2FwcC9jb2RlL3ZpdGUuY29uZmlnLnRzXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ltcG9ydF9tZXRhX3VybCA9IFwiZmlsZTovLy9hcHAvY29kZS92aXRlLmNvbmZpZy50c1wiO2ltcG9ydCB7IGRlZmluZUNvbmZpZywgUGx1Z2luIH0gZnJvbSBcInZpdGVcIjtcbmltcG9ydCByZWFjdCBmcm9tIFwiQHZpdGVqcy9wbHVnaW4tcmVhY3RcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXIgfSBmcm9tIFwiLi9zZXJ2ZXJcIjtcblxuLy8gaHR0cHM6Ly92aXRlanMuZGV2L2NvbmZpZy9cbmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbmZpZygoeyBtb2RlIH0pID0+ICh7XG4gIHNlcnZlcjoge1xuICAgIGhvc3Q6IFwiOjpcIixcbiAgICBwb3J0OiA4MDgwLFxuICAgIGZzOiB7XG4gICAgICBhbGxvdzogW1wiLi9jbGllbnRcIiwgXCIuL3NoYXJlZFwiXSxcbiAgICAgIGRlbnk6IFtcIi5lbnZcIiwgXCIuZW52LipcIiwgXCIqLntjcnQscGVtfVwiLCBcIioqLy5naXQvKipcIiwgXCJzZXJ2ZXIvKipcIl0sXG4gICAgfSxcbiAgfSxcbiAgYnVpbGQ6IHtcbiAgICBvdXREaXI6IFwiZGlzdC9zcGFcIixcbiAgfSxcbiAgcGx1Z2luczogW3JlYWN0KCksIGV4cHJlc3NQbHVnaW4oKV0sXG4gIHJlc29sdmU6IHtcbiAgICBhbGlhczoge1xuICAgICAgXCJAXCI6IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi9jbGllbnRcIiksXG4gICAgICBcIkBzaGFyZWRcIjogcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCIuL3NoYXJlZFwiKSxcbiAgICB9LFxuICB9LFxufSkpO1xuXG5mdW5jdGlvbiBleHByZXNzUGx1Z2luKCk6IFBsdWdpbiB7XG4gIHJldHVybiB7XG4gICAgbmFtZTogXCJleHByZXNzLXBsdWdpblwiLFxuICAgIGFwcGx5OiBcInNlcnZlXCIsIC8vIE9ubHkgYXBwbHkgZHVyaW5nIGRldmVsb3BtZW50IChzZXJ2ZSBtb2RlKVxuICAgIGNvbmZpZ3VyZVNlcnZlcihzZXJ2ZXIpIHtcbiAgICAgIGNvbnN0IGFwcCA9IGNyZWF0ZVNlcnZlcigpO1xuXG4gICAgICAvLyBBZGQgRXhwcmVzcyBhcHAgYXMgbWlkZGxld2FyZSB0byBWaXRlIGRldiBzZXJ2ZXJcbiAgICAgIHNlcnZlci5taWRkbGV3YXJlcy51c2UoYXBwKTtcbiAgICB9LFxuICB9O1xufVxuIiwgImNvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9kaXJuYW1lID0gXCIvYXBwL2NvZGUvc2VydmVyXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ZpbGVuYW1lID0gXCIvYXBwL2NvZGUvc2VydmVyL2luZGV4LnRzXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ltcG9ydF9tZXRhX3VybCA9IFwiZmlsZTovLy9hcHAvY29kZS9zZXJ2ZXIvaW5kZXgudHNcIjtpbXBvcnQgXCJkb3RlbnYvY29uZmlnXCI7XG5pbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IGNvcnMgZnJvbSBcImNvcnNcIjtcbmltcG9ydCB7IGhhbmRsZURlbW8gfSBmcm9tIFwiLi9yb3V0ZXMvZGVtb1wiO1xuaW1wb3J0IHsgYXR0YWNoUmVxdWVzdElkLCBlcnJvckhhbmRsZXIsIHN1Y2Nlc3MgfSBmcm9tIFwiLi9saWIvcmVzcG9uc2VcIjtcbmltcG9ydCB7IGNyZWF0ZUNoZWNrb3V0U2Vzc2lvbiwgY3JlYXRlQmlsbGluZ1BvcnRhbCwgc3RyaXBlV2ViaG9vayB9IGZyb20gXCIuL3JvdXRlcy9zdHJpcGVcIjtcbmltcG9ydCB7IGV4cG9ydEF1ZGl0Q1NWLCBpbXBlcnNvbmF0ZSwgcmVwbGF5RXJyb3IgfSBmcm9tIFwiLi9yb3V0ZXMvYWRtaW5cIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNlcnZlcigpIHtcbiAgY29uc3QgYXBwID0gZXhwcmVzcygpO1xuXG4gIC8vIENvcmUgbWlkZGxld2FyZVxuICBhcHAudXNlKGNvcnMoKSk7XG4gIGFwcC51c2UoYXR0YWNoUmVxdWVzdElkKTtcblxuICAvLyBXZWJob29rIG11c3QgcmVjZWl2ZSByYXcgYm9keSBmb3Igc2lnbmF0dXJlIHZlcmlmaWNhdGlvblxuICBhcHAucG9zdChcbiAgICBcIi9hcGkvc3RyaXBlL3dlYmhvb2tcIixcbiAgICBleHByZXNzLnJhdyh7IHR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiIH0pLFxuICAgIChyZXEsIF9yZXMsIG5leHQpID0+IHtcbiAgICAgIChyZXEgYXMgYW55KS5yYXdCb2R5ID0gcmVxLmJvZHkgYXMgQnVmZmVyO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gICAgc3RyaXBlV2ViaG9vayxcbiAgKTtcblxuICAvLyBKU09OIHBhcnNpbmcgZm9yIG90aGVyIHJvdXRlc1xuICBhcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbiAgYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogdHJ1ZSB9KSk7XG5cbiAgLy8gSGVhbHRoICYgZGVtb1xuICBhcHAuZ2V0KFwiL2FwaS9waW5nXCIsIChyZXEsIHJlcykgPT4ge1xuICAgIGNvbnN0IHBpbmcgPSBwcm9jZXNzLmVudi5QSU5HX01FU1NBR0UgPz8gXCJwaW5nXCI7XG4gICAgcmV0dXJuIHN1Y2Nlc3MocmVxLCByZXMsIHsgbWVzc2FnZTogcGluZyB9KTtcbiAgfSk7XG5cbiAgYXBwLmdldChcIi9hcGkvZGVtb1wiLCBoYW5kbGVEZW1vKTtcblxuICAvLyBCaWxsaW5nIHJvdXRlc1xuICBhcHAucG9zdChcIi9hcGkvYmlsbGluZy9jaGVja291dC1zZXNzaW9uXCIsIGNyZWF0ZUNoZWNrb3V0U2Vzc2lvbik7XG4gIGFwcC5nZXQoXCIvYXBpL2JpbGxpbmcvcG9ydGFsXCIsIGNyZWF0ZUJpbGxpbmdQb3J0YWwpO1xuXG4gIC8vIFN1cGVyIEFkbWluIHJvdXRlcyAoc2VjdXJlZCB2aWEgU3VwYWJhc2UgUkxTIGluIHJlYWwgc2V0dXApXG4gIGFwcC5nZXQoXCIvYXBpL2FkbWluL2F1ZGl0L2V4cG9ydFwiLCBleHBvcnRBdWRpdENTVik7XG4gIGFwcC5wb3N0KFwiL2FwaS9hZG1pbi9pbXBlcnNvbmF0ZVwiLCBpbXBlcnNvbmF0ZSk7XG4gIGFwcC5wb3N0KFwiL2FwaS9hZG1pbi9lcnJvcnMvcmVwbGF5XCIsIHJlcGxheUVycm9yKTtcbiAgYXBwLmdldChcIi9hcGkvYWRtaW4vZXZlbnRzL291dGJveFwiLCBnZXRPdXRib3gpO1xuICBhcHAuZ2V0KFwiL2FwaS9hZG1pbi9kbHFcIiwgZ2V0RExRKTtcbiAgYXBwLnBvc3QoXCIvYXBpL2FkbWluL2RscS9yZXBsYXlcIiwgZGxxUmVwbGF5KTtcbiAgYXBwLmdldChcIi9hcGkvYWRtaW4vZmVhdHVyZS1mbGFnc1wiLCBnZXRGZWF0dXJlRmxhZ3MpO1xuICBhcHAucG9zdChcIi9hcGkvYWRtaW4vZmVhdHVyZS1mbGFnc1wiLCBzZXRGZWF0dXJlRmxhZ3MpO1xuICBhcHAuZ2V0KFwiL2FwaS9hZG1pbi9jb25maWctY2hhbmdlc1wiLCBnZXRDb25maWdDaGFuZ2VzKTtcbiAgYXBwLmdldChcIi9hcGkvYWRtaW4vc3RyaXBlL2V2ZW50c1wiLCBsaXN0U3RyaXBlRXZlbnRzKTtcbiAgYXBwLnBvc3QoXCIvYXBpL2FkbWluL3N1YnNjcmlwdGlvbnMvcmVjb25jaWxlXCIsIHJlY29uY2lsZVN1YnNjcmlwdGlvbnMpO1xuICBhcHAucG9zdChcIi9hcGkvYWRtaW4vaW52aXRlcy9zZW5kXCIsIHNlbmRJbnZpdGUpO1xuICBhcHAucG9zdChcIi9hcGkvYWRtaW4vcmJhYy91cGRhdGVcIiwgcmJhY1VwZGF0ZSk7XG4gIGFwcC5wb3N0KFwiL2FwaS9hZG1pbi9nZHByL2V4cG9ydFwiLCBnZHByRXhwb3J0KTtcbiAgYXBwLnBvc3QoXCIvYXBpL2FkbWluL2dkcHIvZGVsZXRlXCIsIGdkcHJEZWxldGUpO1xuICBhcHAucG9zdChcIi9hcGkvYWRtaW4vaW50ZWdyYXRpb25zL3JvdGF0ZVwiLCByb3RhdGVLZXlzKTtcbiAgYXBwLnBvc3QoXCIvYXBpL2FkbWluL2ludGVncmF0aW9ucy9yZXZva2VcIiwgcmV2b2tlS2V5cyk7XG4gIGFwcC5wb3N0KFwiL2FwaS9hZG1pbi9pbnRlZ3JhdGlvbnMvcmV0cnktc3luY3NcIiwgcmV0cnlTeW5jcyk7XG5cbiAgLy8gRXJyb3IgaGFuZGxlciBsYXN0XG4gIGFwcC51c2UoZXJyb3JIYW5kbGVyKTtcblxuICByZXR1cm4gYXBwO1xufVxuIiwgImNvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9kaXJuYW1lID0gXCIvYXBwL2NvZGUvc2VydmVyL3JvdXRlc1wiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiL2FwcC9jb2RlL3NlcnZlci9yb3V0ZXMvZGVtby50c1wiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9pbXBvcnRfbWV0YV91cmwgPSBcImZpbGU6Ly8vYXBwL2NvZGUvc2VydmVyL3JvdXRlcy9kZW1vLnRzXCI7aW1wb3J0IHsgUmVxdWVzdEhhbmRsZXIgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgRGVtb1Jlc3BvbnNlIH0gZnJvbSBcIkBzaGFyZWQvYXBpXCI7XG5cbmV4cG9ydCBjb25zdCBoYW5kbGVEZW1vOiBSZXF1ZXN0SGFuZGxlciA9IChyZXEsIHJlcykgPT4ge1xuICBjb25zdCByZXNwb25zZTogRGVtb1Jlc3BvbnNlID0ge1xuICAgIG1lc3NhZ2U6IFwiSGVsbG8gZnJvbSBFeHByZXNzIHNlcnZlclwiLFxuICB9O1xuICByZXMuc3RhdHVzKDIwMCkuanNvbihyZXNwb25zZSk7XG59O1xuIiwgImNvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9kaXJuYW1lID0gXCIvYXBwL2NvZGUvc2VydmVyL2xpYlwiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiL2FwcC9jb2RlL3NlcnZlci9saWIvcmVzcG9uc2UudHNcIjtjb25zdCBfX3ZpdGVfaW5qZWN0ZWRfb3JpZ2luYWxfaW1wb3J0X21ldGFfdXJsID0gXCJmaWxlOi8vL2FwcC9jb2RlL3NlcnZlci9saWIvcmVzcG9uc2UudHNcIjtpbXBvcnQgdHlwZSB7IFJlcXVlc3QsIFJlc3BvbnNlLCBOZXh0RnVuY3Rpb24gfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgcmFuZG9tVVVJRCB9IGZyb20gXCJjcnlwdG9cIjtcblxuZXhwb3J0IHR5cGUgQXBpU3VjY2VzczxUID0gYW55PiA9IHsgc3VjY2VzczogdHJ1ZTsgZGF0YTogVDsgcmVxdWVzdElkOiBzdHJpbmcgfTtcbmV4cG9ydCB0eXBlIEFwaUVycm9yID0ge1xuICBzdWNjZXNzOiBmYWxzZTtcbiAgY29kZTogc3RyaW5nO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGRldGFpbHM/OiBhbnk7XG4gIHJlcXVlc3RJZDogc3RyaW5nO1xuICByZXRyeWFibGU/OiBib29sZWFuO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGF0dGFjaFJlcXVlc3RJZChyZXE6IFJlcXVlc3QsIF9yZXM6IFJlc3BvbnNlLCBuZXh0OiBOZXh0RnVuY3Rpb24pIHtcbiAgKHJlcSBhcyBhbnkpLnJlcXVlc3RJZCA9IHJlcS5oZWFkZXJzW1wieC1yZXF1ZXN0LWlkXCJdIHx8IHJhbmRvbVVVSUQoKTtcbiAgbmV4dCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3VjY2VzczxUPihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIGRhdGE6IFQsIHN0YXR1cyA9IDIwMCkge1xuICBjb25zdCBib2R5OiBBcGlTdWNjZXNzPFQ+ID0geyBzdWNjZXNzOiB0cnVlLCBkYXRhLCByZXF1ZXN0SWQ6IChyZXEgYXMgYW55KS5yZXF1ZXN0SWQgfTtcbiAgcmVzLnN0YXR1cyhzdGF0dXMpLmpzb24oYm9keSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcnJvcihyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UsIGNvZGU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBkZXRhaWxzPzogYW55LCBzdGF0dXMgPSA0MDAsIHJldHJ5YWJsZSA9IGZhbHNlKSB7XG4gIGNvbnN0IGJvZHk6IEFwaUVycm9yID0geyBzdWNjZXNzOiBmYWxzZSwgY29kZSwgbWVzc2FnZSwgZGV0YWlscywgcmVxdWVzdElkOiAocmVxIGFzIGFueSkucmVxdWVzdElkLCByZXRyeWFibGUgfTtcbiAgcmVzLnN0YXR1cyhzdGF0dXMpLmpzb24oYm9keSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcnJvckhhbmRsZXIoZXJyOiBhbnksIHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgX25leHQ6IE5leHRGdW5jdGlvbikge1xuICBjb25zdCBtc2cgPSBlcnI/Lm1lc3NhZ2UgfHwgXCJJbnRlcm5hbCBTZXJ2ZXIgRXJyb3JcIjtcbiAgY29uc3QgZGV0YWlscyA9IGVycj8uZGV0YWlscyB8fCB1bmRlZmluZWQ7XG4gIGVycm9yKHJlcSwgcmVzLCBcIklOVEVSTkFMX0VSUk9SXCIsIG1zZywgZGV0YWlscywgNTAwLCBmYWxzZSk7XG59XG4iLCAiY29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2Rpcm5hbWUgPSBcIi9hcHAvY29kZS9zZXJ2ZXIvbGliXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ZpbGVuYW1lID0gXCIvYXBwL2NvZGUvc2VydmVyL2xpYi9ldmVudEJ1cy50c1wiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9pbXBvcnRfbWV0YV91cmwgPSBcImZpbGU6Ly8vYXBwL2NvZGUvc2VydmVyL2xpYi9ldmVudEJ1cy50c1wiO2ltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxudHlwZSBFdmVudFBheWxvYWQgPSB7IHRvcGljOiBzdHJpbmc7IHBheWxvYWQ6IGFueTsgY3JlYXRlZEF0OiBzdHJpbmcgfTtcblxuY29uc3Qgb3V0Ym94OiBFdmVudFBheWxvYWRbXSA9IFtdO1xuXG5jb25zdCBTVVBBQkFTRV9VUkwgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9VUkw7XG5jb25zdCBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcblxubGV0IHN1cGFiYXNlOiBhbnkgPSBudWxsO1xuaWYgKFNVUEFCQVNFX1VSTCAmJiBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZKSB7XG4gIHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFNVUEFCQVNFX1VSTCwgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbWl0RXZlbnQodG9waWM6IHN0cmluZywgcGF5bG9hZDogYW55KSB7XG4gIGNvbnN0IGV2ZW50OiBFdmVudFBheWxvYWQgPSB7IHRvcGljLCBwYXlsb2FkLCBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9O1xuICBvdXRib3gucHVzaChldmVudCk7XG5cbiAgaWYgKHN1cGFiYXNlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oXCJldmVudHNfb3V0Ym94XCIpLmluc2VydCh7IHRvcGljLCBwYXlsb2FkLCBzdGF0dXM6IFwicGVuZGluZ1wiIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIEtlZXAgaW4tbWVtb3J5IG9ubHkgb24gZmFpbHVyZTsgbm8gdGhyb3dcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJPdXRib3ggcGVyc2lzdCBmYWlsZWRcIiwgZSk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRPdXRib3hTbmFwc2hvdCgpIHtcbiAgcmV0dXJuIFsuLi5vdXRib3hdO1xufVxuIiwgImNvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9kaXJuYW1lID0gXCIvYXBwL2NvZGUvc2VydmVyL3JvdXRlc1wiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9maWxlbmFtZSA9IFwiL2FwcC9jb2RlL3NlcnZlci9yb3V0ZXMvc3RyaXBlLnRzXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ltcG9ydF9tZXRhX3VybCA9IFwiZmlsZTovLy9hcHAvY29kZS9zZXJ2ZXIvcm91dGVzL3N0cmlwZS50c1wiO2ltcG9ydCB0eXBlIHsgUmVxdWVzdEhhbmRsZXIgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgZXJyb3IsIHN1Y2Nlc3MgfSBmcm9tIFwiLi4vbGliL3Jlc3BvbnNlXCI7XG5pbXBvcnQgeyBlbWl0RXZlbnQgfSBmcm9tIFwiLi4vbGliL2V2ZW50QnVzXCI7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVDaGVja291dFNlc3Npb246IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHBsYW4gPSByZXEuYm9keT8ucGxhbjtcbiAgaWYgKCFwbGFuKSByZXR1cm4gZXJyb3IocmVxLCByZXMsIFwiSU5WQUxJRF9SRVFVRVNUXCIsIFwiTWlzc2luZyBwbGFuXCIsIHVuZGVmaW5lZCwgNDAwKTtcblxuICAvLyBTdHViIHVudGlsIFN0cmlwZSBpcyBjb25maWd1cmVkXG4gIHJldHVybiBlcnJvcihcbiAgICByZXEsXG4gICAgcmVzLFxuICAgIFwiU1RSSVBFX05PVF9DT05GSUdVUkVEXCIsXG4gICAgXCJTdHJpcGUgbm90IGNvbmZpZ3VyZWQuIFNldCBTVFJJUEVfU0VDUkVUX0tFWSBhbmQgcHJpY2UgSURzIHRvIGVuYWJsZSBjaGVja291dC5cIixcbiAgICB1bmRlZmluZWQsXG4gICAgNTAxLFxuICAgIGZhbHNlLFxuICApO1xufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUJpbGxpbmdQb3J0YWw6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIC8vIFN0dWIgdW50aWwgU3RyaXBlIGlzIGNvbmZpZ3VyZWRcbiAgcmV0dXJuIGVycm9yKFxuICAgIHJlcSxcbiAgICByZXMsXG4gICAgXCJTVFJJUEVfTk9UX0NPTkZJR1VSRURcIixcbiAgICBcIlN0cmlwZSBub3QgY29uZmlndXJlZC4gU2V0IFNUUklQRV9TRUNSRVRfS0VZIHRvIGVuYWJsZSBwb3J0YWwuXCIsXG4gICAgdW5kZWZpbmVkLFxuICAgIDUwMSxcbiAgICBmYWxzZSxcbiAgKTtcbn07XG5cbmV4cG9ydCBjb25zdCBzdHJpcGVXZWJob29rOiBSZXF1ZXN0SGFuZGxlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAvLyBBY2NlcHQgd2ViaG9vayBhbmQgZW5xdWV1ZSBldmVudCB3aXRob3V0IHZlcmlmaWNhdGlvbiB1bnRpbCBjb25maWd1cmVkXG4gIGF3YWl0IGVtaXRFdmVudChcImJpbGxpbmcud2ViaG9va19yZWNlaXZlZF91bnZlcmlmaWVkXCIsIHsgcmVjZWl2ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pO1xuICByZXR1cm4gc3VjY2VzcyhyZXEsIHJlcywgeyByZWNlaXZlZDogdHJ1ZSB9KTtcbn07XG4iLCAiY29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2Rpcm5hbWUgPSBcIi9hcHAvY29kZS9zZXJ2ZXIvcm91dGVzXCI7Y29uc3QgX192aXRlX2luamVjdGVkX29yaWdpbmFsX2ZpbGVuYW1lID0gXCIvYXBwL2NvZGUvc2VydmVyL3JvdXRlcy9hZG1pbi50c1wiO2NvbnN0IF9fdml0ZV9pbmplY3RlZF9vcmlnaW5hbF9pbXBvcnRfbWV0YV91cmwgPSBcImZpbGU6Ly8vYXBwL2NvZGUvc2VydmVyL3JvdXRlcy9hZG1pbi50c1wiO2ltcG9ydCB0eXBlIHsgUmVxdWVzdEhhbmRsZXIgfSBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgc3VjY2VzcywgZXJyb3IgfSBmcm9tIFwiLi4vbGliL3Jlc3BvbnNlXCI7XG5pbXBvcnQgeyBlbWl0RXZlbnQsIGdldE91dGJveFNuYXBzaG90IH0gZnJvbSBcIi4uL2xpYi9ldmVudEJ1c1wiO1xuXG4vLyBzaW1wbGUgaW4tbWVtb3J5IHN0b3Jlc1xubGV0IEZFQVRVUkVfRkxBR1M6IHsga2V5OiBzdHJpbmc7IGVuYWJsZWQ6IGJvb2xlYW4gfVtdID0gW1xuICB7IGtleTogXCJuZXctYW5hbHl0aWNzXCIsIGVuYWJsZWQ6IHRydWUgfSxcbiAgeyBrZXk6IFwiYmV0YS1wb3NcIiwgZW5hYmxlZDogZmFsc2UgfSxcbl07XG5jb25zdCBETFE6IHsgaWQ6IHN0cmluZzsgcmVhc29uOiBzdHJpbmcgfVtdID0gW1xuICB7IGlkOiBcImRscS0xXCIsIHJlYXNvbjogXCJzdHJpcGUgd2ViaG9vayB2ZXJpZnkgZmFpbGVkXCIgfSxcbiAgeyBpZDogXCJkbHEtMlwiLCByZWFzb246IFwiemFwaWVyIHRpbWVvdXRcIiB9LFxuXTtcbmNvbnN0IENPTkZJR19MT0c6IHsgaWQ6IHN0cmluZzsgY2hhbmdlOiBzdHJpbmc7IGF0OiBzdHJpbmcgfVtdID0gW1xuICB7IGlkOiBcImNmZy0xXCIsIGNoYW5nZTogXCJVcGRhdGVkIHBsYW4gcHJpY2luZ1wiLCBhdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0sXG4gIHsgaWQ6IFwiY2ZnLTJcIiwgY2hhbmdlOiBcIlJvdGF0ZWQgU2xhY2sgd2ViaG9vayBrZXlcIiwgYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9LFxuXTtcblxuZXhwb3J0IGNvbnN0IGV4cG9ydEF1ZGl0Q1NWOiBSZXF1ZXN0SGFuZGxlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCBjc3YgPSBbXG4gICAgXCJpZCxvcmcsdXNlcixhY3Rpb24sY3JlYXRlZF9hdFwiLFxuICAgIGBlMSxUZWNoQ29ycCxhZG1pbkB0ZWNoY29ycC5jb20sYmlsbGluZy5zdWJzY3JpcHRpb25fdXBkYXRlZCwke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1gLFxuICBdLmpvaW4oXCJcXG5cIik7XG4gIHJlcy5zZXRIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJ0ZXh0L2NzdlwiKTtcbiAgcmVzLnNldEhlYWRlcihcIkNvbnRlbnQtRGlzcG9zaXRpb25cIiwgYGF0dGFjaG1lbnQ7IGZpbGVuYW1lPVwiYXVkaXQtJHtEYXRlLm5vdygpfS5jc3ZcImApO1xuICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoY3N2KTtcbn07XG5cbmV4cG9ydCBjb25zdCBpbXBlcnNvbmF0ZTogUmVxdWVzdEhhbmRsZXIgPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgdXNlcklkID0gcmVxLmJvZHk/LnVzZXJJZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGlmICghdXNlcklkKSByZXR1cm4gZXJyb3IocmVxLCByZXMsIFwiSU5WQUxJRF9SRVFVRVNUXCIsIFwiTWlzc2luZyB1c2VySWRcIiwgdW5kZWZpbmVkLCA0MDApO1xuICBhd2FpdCBlbWl0RXZlbnQoXCJhZG1pbi5pbXBlcnNvbmF0aW9uX3JlcXVlc3RlZFwiLCB7IHVzZXJJZCwgcmVxdWVzdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KTtcbiAgcmV0dXJuIHN1Y2Nlc3MocmVxLCByZXMsIHsgb2s6IHRydWUsIG5vdGU6IFwiSW1wZXJzb25hdGlvbiByZXF1aXJlcyBzZWN1cmUgYmFja2VuZCBzZXNzaW9uIGV4Y2hhbmdlOyBzdHViYmVkIGhlcmUuXCIgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgcmVwbGF5RXJyb3I6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IGlkID0gcmVxLmJvZHk/LmlkIGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgaWYgKCFpZCkgcmV0dXJuIGVycm9yKHJlcSwgcmVzLCBcIklOVkFMSURfUkVRVUVTVFwiLCBcIk1pc3NpbmcgaWRcIiwgdW5kZWZpbmVkLCA0MDAsIGZhbHNlKTtcbiAgYXdhaXQgZW1pdEV2ZW50KFwiYWRtaW4uZXJyb3JfcmVwbGF5X3RyaWdnZXJlZFwiLCB7IGlkIH0pO1xuICByZXR1cm4gc3VjY2VzcyhyZXEsIHJlcywgeyBvazogdHJ1ZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRPdXRib3g6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IGV2ZW50czogZ2V0T3V0Ym94U25hcHNob3QoKSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRETFE6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IGl0ZW1zOiBETFEgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZGxxUmVwbGF5OiBSZXF1ZXN0SGFuZGxlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBjb25zdCBpZCA9IHJlcS5ib2R5Py5pZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIGlmICghaWQpIHJldHVybiBlcnJvcihyZXEsIHJlcywgXCJJTlZBTElEX1JFUVVFU1RcIiwgXCJNaXNzaW5nIGlkXCIsIHVuZGVmaW5lZCwgNDAwKTtcbiAgYXdhaXQgZW1pdEV2ZW50KFwiYWRtaW4uZGxxX3JlcGxheV90cmlnZ2VyZWRcIiwgeyBpZCB9KTtcbiAgcmV0dXJuIHN1Y2Nlc3MocmVxLCByZXMsIHsgb2s6IHRydWUgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0RmVhdHVyZUZsYWdzOiBSZXF1ZXN0SGFuZGxlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICByZXR1cm4gc3VjY2VzcyhyZXEsIHJlcywgeyBmbGFnczogRkVBVFVSRV9GTEFHUyB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBzZXRGZWF0dXJlRmxhZ3M6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IGZsYWdzID0gcmVxLmJvZHk/LmZsYWdzIGFzIHR5cGVvZiBGRUFUVVJFX0ZMQUdTIHwgdW5kZWZpbmVkO1xuICBpZiAoIWZsYWdzKSByZXR1cm4gZXJyb3IocmVxLCByZXMsIFwiSU5WQUxJRF9SRVFVRVNUXCIsIFwiTWlzc2luZyBmbGFnc1wiLCB1bmRlZmluZWQsIDQwMCk7XG4gIEZFQVRVUkVfRkxBR1MgPSBmbGFncztcbiAgYXdhaXQgZW1pdEV2ZW50KFwiYWRtaW4uZmVhdHVyZV9mbGFnc191cGRhdGVkXCIsIHsgZmxhZ3MgfSk7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IG9rOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldENvbmZpZ0NoYW5nZXM6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IGl0ZW1zOiBDT05GSUdfTE9HIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGxpc3RTdHJpcGVFdmVudHM6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IGV2ZW50cyA9IFtcbiAgICB7IGlkOiBcImV2dF8xXCIsIHR5cGU6IFwiaW52b2ljZS5wYXltZW50X3N1Y2NlZWRlZFwiLCBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSxcbiAgICB7IGlkOiBcImV2dF8yXCIsIHR5cGU6IFwiaW52b2ljZS5wYXltZW50X2ZhaWxlZFwiLCBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSxcbiAgXTtcbiAgcmV0dXJuIHN1Y2Nlc3MocmVxLCByZXMsIHsgZXZlbnRzIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlY29uY2lsZVN1YnNjcmlwdGlvbnM6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGF3YWl0IGVtaXRFdmVudChcImJpbGxpbmcucmVjb25jaWxlX3JlcXVlc3RlZFwiLCB7IGF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSk7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IG9rOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHNlbmRJbnZpdGU6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHsgZW1haWwsIG9yZyB9ID0gcmVxLmJvZHkgfHwge307XG4gIGlmICghZW1haWwpIHJldHVybiBlcnJvcihyZXEsIHJlcywgXCJJTlZBTElEX1JFUVVFU1RcIiwgXCJNaXNzaW5nIGVtYWlsXCIsIHVuZGVmaW5lZCwgNDAwKTtcbiAgYXdhaXQgZW1pdEV2ZW50KFwiYWRtaW4uaW52aXRlX3NlbnRcIiwgeyBlbWFpbCwgb3JnIH0pO1xuICByZXR1cm4gc3VjY2VzcyhyZXEsIHJlcywgeyBvazogdHJ1ZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCByYmFjVXBkYXRlOiBSZXF1ZXN0SGFuZGxlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBhd2FpdCBlbWl0RXZlbnQoXCJhZG1pbi5yYmFjX3VwZGF0ZWRcIiwgeyBtYXRyaXg6IHJlcS5ib2R5Py5tYXRyaXggfSk7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IG9rOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGdkcHJFeHBvcnQ6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGF3YWl0IGVtaXRFdmVudChcImFkbWluLmdkcHJfZXhwb3J0X3JlcXVlc3RlZFwiLCB7IGVtYWlsOiByZXEuYm9keT8uZW1haWwgfSk7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IG9rOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGdkcHJEZWxldGU6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGF3YWl0IGVtaXRFdmVudChcImFkbWluLmdkcHJfZGVsZXRlX3NjaGVkdWxlZFwiLCB7IGVtYWlsOiByZXEuYm9keT8uZW1haWwgfSk7XG4gIHJldHVybiBzdWNjZXNzKHJlcSwgcmVzLCB7IG9rOiB0cnVlIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHJvdGF0ZUtleXM6IFJlcXVlc3RIYW5kbGVyID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gIGF3YWl0IGVtaXRFdmVudChcImludGVncmF0aW9ucy5rZXlzX3JvdGF0ZWRcIiwgeyBhdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIH0pO1xuICByZXR1cm4gc3VjY2VzcyhyZXEsIHJlcywgeyBvazogdHJ1ZSB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXZva2VLZXlzOiBSZXF1ZXN0SGFuZGxlciA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICBhd2FpdCBlbWl0RXZlbnQoXCJpbnRlZ3JhdGlvbnMua2V5c19yZXZva2VkXCIsIHsgYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KTtcbiAgcmV0dXJuIHN1Y2Nlc3MocmVxLCByZXMsIHsgb2s6IHRydWUgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgcmV0cnlTeW5jczogUmVxdWVzdEhhbmRsZXIgPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgYXdhaXQgZW1pdEV2ZW50KFwiaW50ZWdyYXRpb25zLnJldHJ5X3N5bmNzXCIsIHsgYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KTtcbiAgcmV0dXJuIHN1Y2Nlc3MocmVxLCByZXMsIHsgb2s6IHRydWUgfSk7XG59O1xuIl0sCiAgIm1hcHBpbmdzIjogIjtBQUE2TSxTQUFTLG9CQUE0QjtBQUNsUCxPQUFPLFdBQVc7QUFDbEIsT0FBTyxVQUFVOzs7QUNGcU0sT0FBTztBQUM3TixPQUFPLGFBQWE7QUFDcEIsT0FBTyxV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
